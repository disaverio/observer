"use strict";!function(a,b){function c(a){return Array.isArray?Array.isArray(a):void 0!==a&&a&&a.constructor===Array}function d(b,c){if(b){for(var d=[],e=0;e<b.length;e++)b[e].constructor===Function?d.push(b[e]()):b[e]==a.OBS_OBSERVED_RETURNED?d.push(c):d.push(b[e]);return d}}function e(b,c){function d(b){function d(a,b){return b.length>1?d(a[b[0]],b.slice(1)):a[b[0]]===Function?a[b[0]]():a[b[0]]}if(b.firstParam==a.OBS_OBSERVED_RETURNED)var e=c;else if(b.firstParam.constructor===Function)var e=b.firstParam();else if(b.firstType==OBS_PRIMITIVE)var e=b.firstParam;else var e=d(b.firstScope,b.firstParam.split("."));if(!b.secondParam&&!b.secondType)return!!e;if(b.secondParam==a.OBS_OBSERVED_RETURNED)var f=c;else if(b.secondParam.constructor===Function)var f=b.secondParam();else if(b.secondType==OBS_PRIMITIVE)var f=b.secondParam;else var f=d(b.secondScope,b.secondParam.split("."));switch(b.operator){case"===":return e===f;case"!==":return e!==f;case"==":return e==f;case"!=":return e!=f;case"<":return e<f;case"<=":return e<=f;case">":return e>f;case">=":return e>=f;default:return!1}}if(!b)return!0;if("CONDITION"==b.type)return d(b);if("AND"==b.operator){for(var f=0;f<b.sons.length;f++){var g=e(b.sons[f],c);if(!g)return!1}return!0}if("OR"==b.operator){for(var f=0;f<b.sons.length;f++){var g=e(b.sons[f],c);if(g)return!0}return!1}return"NOT"==b.operator?!e(b.sons[0],c):void 0}function f(b){function d(a){if("OR"!=a[0]&&"AND"!=a[0]&&"NOT"!=a[0])throw new Error("Observer | Unknown operator: '"+a[0]+"'");if("NOT"==a[0]&&2!=a.length)throw new Error("Observer | 'NOT' operator must have only one argument.");if(("OR"==a[0]||"AND"==a[0])&&a.length<=2)throw new Error("Observer | '"+a[0]+"' operator must have at least two arguments.");var b={type:"OPERATOR",operator:a[0],sons:[]};return a.slice(1).forEach(function(a){c(a)?b.sons.push(d(a)):b.sons.push(e(a))}),b}function e(b){if(b.constructor===Function&&(b={firstParam:b}),!b||!b.firstParam)throw new Error("Observer | Invalid condition: "+b.operator);if(b.operator&&"==="!=b.operator&&"!=="!=b.operator&&"=="!=b.operator&&"!="!=b.operator&&">"!=b.operator&&">="!=b.operator&&"<"!=b.operator&&"<="!=b.operator)throw new Error("Observer | Unknown operator: '"+b.operator+"'");return{type:"CONDITION",firstParam:b.firstParam,firstType:b.firstType,firstScope:b.firstScope||a,operator:b.operator||"==",secondParam:b.secondParam,secondType:b.secondType,secondScope:b.secondScope||a}}if(b)return c(b)?d(b):e(b)}function g(a){return this.subscribers.push({fn:a.constructor===Function?a:a.fn,conditions:a.constructor===Function?void 0:f(a.conditions),params:a.constructor===Function?void 0:a.params,context:a.constructor===Function?void 0:a.context}),this}function h(a){for(var b=this.subscribers.length-1;b>=0;b--)this.subscribers[b].fn==a&&this.subscribers.splice(b,1);return this}function i(){return this.subscribers=[],this}var j=Math.random().toString(36).slice(2);a.OBS_OBSERVED_RETURNED=Math.random(),a.OBS_PRIMITIVE=Math.random(),Function.prototype.observable=function(){var a=this,b=function(){var c="state_"+j,f=Array.prototype.slice.call(arguments),g=f.slice(-1)[0];if(g&&g.ID==j){if(b[c]==g.state)return;f.splice(-1,1)}else g={ID:j,state:Math.random().toString(36).slice(2)};b[c]=g.state;var h=a.apply(this,f);return b.subscribers.forEach(function(a){if(a.fn[c]!=b[c]&&e(a.conditions,h)){var f=d(a.params,h);a.fn.subscribers&&a.fn.addObserver&&a.fn.removeObserver&&a.fn.removeAllObservers?(f=f||[],f.push(g)):a.fn[c]=g.state,a.fn.apply(a.fn.context,f)}}),h};return b.subscribers=[],b.addObserver=g.bind(b),b.removeObserver=h.bind(b),b.removeAllObservers=i.bind(b),b}}(this);